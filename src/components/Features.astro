---
import { Image } from "astro:assets";
import trackingImg from "../assets/pictures/tech-tracking.png";
import displayImg from "../assets/pictures/tech-display.png";
import sensorsImg from "../assets/pictures/tech-sensors.png";
import controlImg from "../assets/pictures/tech-control.png";
import audioImg from "../assets/pictures/tech-audio.png";
import breathingImg from "../assets/pictures/tech-breathing.png";
import Arrow from "./Arrow.astro";

const features = [
    {
        title: "Contactless Sleep Tracking",
        description:
            "A silent radar detects your sleep stages and breathing rate through the covers, accurately mapping your sleep without ever watching you.",
        image: trackingImg,
    },
    {
        title: "Phantom Wood Display",
        description:
            "The time shines clearly through the natural wood when you need it, and vanishes completely when you don't, ensuring zero light pollution.",
        image: displayImg,
    },
    {
        title: "Ambient Sensors",
        description:
            "Amber monitors CO2, temperature, and humidity levels to help you understand how air quality impacts your deep sleep.",
        image: sensorsImg,
    },
    {
        title: "Blind Control System",
        description:
            "Adjust volume, light, or snooze the alarm using intuitive touch controls on the wood, no need to open your eyes or look at a screen.",
        image: controlImg,
    },
    {
        title: "Immersive Audio",
        description:
            "A 360Â° speaker fills the room with deep Brown Noise or guided meditations. No microphones included, Amber speaks, but never listens.",
        image: audioImg,
    },
    {
        title: "Breathing Light",
        description:
            "The light pulses in a slow, organic rhythm, guiding your breath to lower your heart rate and calm your mind without saying a word.",
        image: breathingImg,
    },
];
---

<section class="pt-7xl overflow-hidden">
    <div class="flex flex-col gap-3xl">
        <div
            class="flex flex-col md:flex-row md:justify-between md:items-end mb-6xl md:mb-9xl gap-lg px-container"
        >
            <div class="md:max-w-7/12 flex flex-col gap-xs">
                <h2 class="title-2xl text-text-primary mb-sm">
                    Invisible Intelligence
                </h2>
                <p class="body-md text-text-primary">
                    Advanced bio-sensing technology hidden inside natural
                    materials. No cameras. No microphones. No wearables.
                </p>
            </div>

            <div class="flex gap-xs justify-end">
                <Arrow
                    id="prev"
                    direction="left"
                    color="dark"
                    state="inactive"
                />
                <Arrow
                    id="next"
                    direction="right"
                    color="dark"
                    state="active"
                />
            </div>
        </div>

        <div
            id="carousel"
            role="region"
            aria-label="Features carousel"
            class="flex gap-lg overflow-x-auto snap-x snap-mandatory no-scrollbar scroll-pl-container pl-container pr-container"
        >
            {
                features.map((feature) => (
                    <div class="flex-none w-[92vw] md:w-[31.75%] snap-start flex flex-col gap-xs">
                        <div class="w-full h-md overflow-hidden rounded-medium">
                            <Image
                                src={feature.image}
                                alt={feature.title}
                                class="w-full h-full object-cover"
                                width={600}
                                height={400}
                                format="webp"
                            />
                        </div>
                        <div class="flex flex-col gap-3xs md:gap-2xs">
                            <h3 class="title-md text-text-primary">
                                {feature.title}
                            </h3>
                            <p class="body-sm text-text-primary">
                                {feature.description}
                            </p>
                        </div>
                    </div>
                ))
            }
        </div>
    </div>
</section>

<style>
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>

<script>
    const carousel = document.getElementById("carousel");
    const prevBtn = document.getElementById("prev") as HTMLButtonElement;
    const nextBtn = document.getElementById("next") as HTMLButtonElement;

    let isScrolling = false;

    function updateArrowStates() {
        if (!carousel || !prevBtn || !nextBtn) return;

        const scrollLeft = Math.ceil(carousel.scrollLeft);
        const maxScroll = carousel.scrollWidth - carousel.clientWidth;

        const isAtStart = scrollLeft <= 10;
        prevBtn.disabled = isAtStart;
        prevBtn.setAttribute("data-state", isAtStart ? "inactive" : "active");

        const isAtEnd = scrollLeft >= maxScroll - 20;
        nextBtn.disabled = isAtEnd;
        nextBtn.setAttribute("data-state", isAtEnd ? "inactive" : "active");

        isScrolling = false;
    }

    carousel?.addEventListener("scroll", () => {
        if (!isScrolling) {
            window.requestAnimationFrame(updateArrowStates);
            isScrolling = true;
        }
    });

    window.addEventListener("resize", updateArrowStates);
    updateArrowStates();

    nextBtn?.addEventListener("click", () => {
        carousel?.scrollBy({
            left: carousel.clientWidth * 0.4,
            behavior: "smooth",
        });
    });

    prevBtn?.addEventListener("click", () => {
        carousel?.scrollBy({
            left: -carousel.clientWidth * 0.4,
            behavior: "smooth",
        });
    });
</script>
