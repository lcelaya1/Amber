---
import Arrow from "./Arrow.astro";
import reviewBg from "../assets/pictures/review-bg.png";

const reviews = [
    {
        quote: "Finally, sleep tech that doesn't look like a medical device. It feels like a piece of crafted furniture, not a gadget. I actually want this on my nightstand.",
        author: "Sarah J. (Interior Architect & Beta Tester)",
    },
    {
        quote: "I hated wearing a watch to bed. Amber’s radar tracking is mind-blowing, it captures my sleep stages perfectly without me having to wear or charge anything.",
        author: "Mark T. (Software Engineer & Beta Tester)",
    },
    {
        quote: "The sunset mode has become my non-negotiable ritual. Watching the light turn deep red instantly signals my brain that the stress of the day is over.",
        author: "Elena R. (Wellness Coach & Beta Tester)",
    },
];
---

<section
    class="w-full px-container h-2xl overflow-hidden bg-cover bg-center py-6xl relative"
    style={`background-image: url(${reviewBg.src});`}
    id="reviews-section"
>
    <div class="flex flex-col justify-between h-full relative z-10">
        <div class="grid grid-cols-1 grid-rows-1">
            {
                reviews.map((review, index) => (
                    <div
                        class="review-slide col-start-1 row-start-1 w-full md:w-6/12 flex flex-col gap-lg transition-all duration-700 ease-in-out"
                        data-index={index}
                        data-active={index === 0 ? "true" : "false"}
                    >
                        <blockquote class="title-xl text-text-primary-invert">
                            “{review.quote}”
                        </blockquote>
                        <cite class="title-md text-text-primary-invert italic">
                            — {review.author}
                        </cite>
                    </div>
                ))
            }
        </div>

        <div class="flex gap-xs justify-end">
            <Arrow
                id="rev-prev"
                direction="left"
                color="light"
                state="inactive"
            />
            <Arrow
                id="rev-next"
                direction="right"
                color="light"
                state="active"
            />
        </div>
    </div>
</section>

<style>
    .review-slide {
        opacity: 0;
        transform: translateX(30px);
        pointer-events: none;
        visibility: hidden;
    }

    .review-slide[data-active="true"] {
        opacity: 1;
        transform: translateX(0);
        pointer-events: auto;
        visibility: visible;
        z-index: 20;
    }
</style>

<script>
    const slides = document.querySelectorAll(".review-slide");
    const prevBtn = document.getElementById("rev-prev") as HTMLButtonElement;
    const nextBtn = document.getElementById("rev-next") as HTMLButtonElement;

    let currentIndex = 0;
    const totalSlides = slides.length;

    function updateReviews() {
        if (!prevBtn || !nextBtn) return;

        slides.forEach((slide, i) => {
            slide.setAttribute(
                "data-active",
                i === currentIndex ? "true" : "false",
            );
        });

        currentIndex === 0
            ? (prevBtn.setAttribute("disabled", "true"),
              prevBtn.setAttribute("data-state", "inactive"))
            : (prevBtn.removeAttribute("disabled"),
              prevBtn.setAttribute("data-state", "active"));

        currentIndex === totalSlides - 1
            ? (nextBtn.setAttribute("disabled", "true"),
              nextBtn.setAttribute("data-state", "inactive"))
            : (nextBtn.removeAttribute("disabled"),
              nextBtn.setAttribute("data-state", "active"));
    }

    nextBtn?.addEventListener("click", () => {
        if (currentIndex < totalSlides - 1) {
            currentIndex++;
            updateReviews();
        }
    });
    prevBtn?.addEventListener("click", () => {
        if (currentIndex > 0) {
            currentIndex--;
            updateReviews();
        }
    });

    updateReviews();
</script>
