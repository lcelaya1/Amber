---
interface Props {
  question: string;
  answer: string;
}

const { question, answer } = Astro.props;
---

<div
  class="faq-item border-b border-border-primary last:border-none group overflow-hidden first:pt-0 py-sm"
>
  <button
    class="faq-trigger w-full flex justify-between items-center text-left transition-opacity focus:outline-none cursor-pointer group/btn"
    aria-expanded="false"
  >
    <h3 class="title-sm text-text-primary text-wrap!">
      {question}
    </h3>
    <div class="relative w-3.5 h-3.5 shrink-0">
      <div
        class="absolute inset-x-0 top-1/2 -translate-y-1/2 h-[1.5px] bg-text-primary"
      >
      </div>
      <div
        class="faq-plus-vertical absolute inset-y-0 left-1/2 -translate-x-1/2 w-[1.5px] bg-text-primary transition-transform duration-500 ease-out"
      >
      </div>
    </div>
  </button>

  <div
    class="faq-content grid grid-rows-[0fr] transition-[grid-template-rows] duration-500 ease-in-out"
  >
    <div class="overflow-hidden">
      <div class="pt-2xs pb-xs">
        <p class="body-sm text-text-primary">
          {answer}
        </p>
      </div>
    </div>
  </div>
</div>

<style>
  .faq-trigger[aria-expanded="true"] .faq-plus-vertical {
    transform: rotate(90deg);
  }

  .faq-trigger[aria-expanded="true"] + .faq-content {
    grid-template-rows: 1fr;
  }
</style>

<script>
  function setupFaq() {
    const allTriggers = document.querySelectorAll(".faq-trigger");

    allTriggers.forEach((trigger) => {
      trigger.removeEventListener("click", toggleFaq);
      trigger.addEventListener("click", toggleFaq);
    });

    function toggleFaq(e) {
      const btn = e.currentTarget;
      const isOpen = btn.getAttribute("aria-expanded") === "true";

      if (!isOpen) {
        allTriggers.forEach((other) => {
          if (other !== btn) other.setAttribute("aria-expanded", "false");
        });
      }

      btn.setAttribute("aria-expanded", !isOpen ? "true" : "false");
    }
  }

  setupFaq();
  document.addEventListener("astro:after-swap", setupFaq);
</script>
