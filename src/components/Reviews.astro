---
import { Image } from "astro:assets";
import Arrow from "./Arrow.astro";
import reviewBg from "../assets/pictures/review-bg.png";

const reviews = [
    {
        quote: "Finally, sleep tech that doesn't look like a medical device. It feels like a piece of crafted furniture, not a gadget. I actually want this on my nightstand.",
        author: "Sarah J. (Interior Architect & Beta Tester)",
    },
    {
        quote: "I hated wearing a watch to bed. Amber’s radar tracking is mind-blowing, it captures my sleep stages perfectly without me having to wear or charge anything.",
        author: "Mark T. (Software Engineer & Beta Tester)",
    },
    {
        quote: "The sunset mode has become my non-negotiable ritual. Watching the light turn deep red instantly signals my brain that the stress of the day is over.",
        author: "Elena R. (Wellness Coach & Beta Tester)",
    },
];
---

<section
    class="w-full px-container h-2xl overflow-hidden bg-cover bg-center py-6xl relative"
    style={`background-image: url(${reviewBg.src});`}
    id="reviews-section"
>
    <div class="flex flex-col justify-between h-full relative z-10">
        <div class="relative h-64 md:h-auto">
            {
                reviews.map((review, index) => (
                    <div
                        class="review-slide absolute inset-0 w-full md:w-6/12 flex flex-col gap-lg transition-all duration-700 ease-in-out"
                        data-index={index}
                        style={index === 0 ? "opacity: 1; transform: translateX(0); z-index: 20;" : "opacity: 0; transform: translateX(30px); z-index: 10; pointer-events: none;"}
                    >
                        <blockquote class="title-xl text-text-primary-invert">
                            “{review.quote}”
                        </blockquote>
                        <cite class="title-md text-text-primary-invert italic">
                            — {review.author}
                        </cite>
                    </div>
                ))
            }
        </div>

        <div class="flex gap-xs justify-end">
            <Arrow
                id="rev-prev"
                direction="left"
                color="light"
                state="inactive"
            />
            <Arrow
                id="rev-next"
                direction="right"
                color="light"
                state="active"
            />
        </div>
    </div>
</section>

<script>
    const slides = document.querySelectorAll('.review-slide');
    const prevBtn = document.getElementById('rev-prev') as HTMLButtonElement;
    const nextBtn = document.getElementById('rev-next') as HTMLButtonElement;
    
    let currentIndex = 0;
    const totalSlides = slides.length;

    function updateReviews() {
        if (!prevBtn || !nextBtn) return;

        // 1. Update Slide Visibility
        slides.forEach((slide, i) => {
            const s = slide as HTMLElement;
            if (i === currentIndex) {
                s.style.opacity = "1";
                s.style.transform = "translateX(0)";
                s.style.zIndex = "20";
                s.style.pointerEvents = "auto";
            } else {
                s.style.opacity = "0";
                s.style.transform = "translateX(30px)";
                s.style.zIndex = "10";
                s.style.pointerEvents = "none";
            }
        });

        // 2. Update Prev Arrow State (Disabled at Start)
        if (currentIndex === 0) {
            prevBtn.disabled = true;
            prevBtn.classList.add("text-text-primary-invert", "border-border-primary-invert", "cursor-not-allowed");
            prevBtn.classList.remove("bg-surface-primary", "text-text-primary", "border-border-primary-invert", "cursor-pointer");
        } else {
            prevBtn.disabled = false;
            prevBtn.classList.remove("text-text-primary-invert", "border-border-primary-invert", "cursor-not-allowed");
            prevBtn.classList.add("bg-surface-primary", "text-text-primary", "border-border-primary-invert", "cursor-pointer");
        }

        // 3. Update Next Arrow State (Disabled at End)
        if (currentIndex === totalSlides - 1) {
            nextBtn.disabled = true;
            nextBtn.classList.add("text-text-primary-invert", "border-border-primary-invert", "cursor-not-allowed");
            nextBtn.classList.remove("bg-surface-primary", "text-text-primary", "border-border-primary-invert", "cursor-pointer");
        } else {
            nextBtn.disabled = false;
            nextBtn.classList.remove("text-text-primary-invert", "border-border-primary-invert", "cursor-not-allowed");
            nextBtn.classList.add("bg-surface-primary", "text-text-primary", "border-border-primary-invert", "cursor-pointer");
        }
    }

    // Click Events
    nextBtn?.addEventListener('click', () => {
        if (currentIndex < totalSlides - 1) {
            currentIndex++;
            updateReviews();
        }
    });

    prevBtn?.addEventListener('click', () => {
        if (currentIndex > 0) {
            currentIndex--;
            updateReviews();
        }
    });

    // Initialize state
    updateReviews();
</script>